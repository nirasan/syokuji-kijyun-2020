package main

import (
	"flag"
	"fmt"
	"strconv"
	"strings"

	"github.com/nirasan/syokuji-kijyun-2020/pkg"
	"github.com/nirasan/syokuji-kijyun-2020/tools"
)

func main() {
	flag.Parse()
	pkgName := flag.Arg(0)
	outputFile := flag.Arg(1)

	lines := strings.Split(src, "\n")
	// 年齢ごとの必要量
	data := make([]pkg.EnergyDatum, 0)
	for i := 0; i <= 14; i++ {
		cols := strings.Split(lines[i], " ")
		for j := len(cols) - 6; j < len(cols); j++ {
			k := j - (len(cols) - 6)

			gender := pkg.GenderMale
			if k >= 3 {
				gender = pkg.GenderFemale
			}

			age := i

			activityLevel := k % 3

			s := strings.ReplaceAll(cols[j], ",", "")
			valid := false
			v, err := strconv.ParseFloat(s, 64)
			if err == nil {
				valid = true
			}

			datum := pkg.EnergyDatum{
				Gender:        gender,
				Age:           age,
				ActivityLevel: activityLevel,
				Value:         v,
				Valid:         valid,
			}
			data = append(data, datum)
		}
	}

	g := tools.NewGenerator()
	g.MustWrite("// Code generated by \"bin/energy/main.go\"; DO NOT EDIT.\n")
	g.MustWrite("package %s\n", pkgName)
	g.MustWrite("func (e *Energy) Data() []EnergyDatum {\n")
	g.MustWrite("    return []EnergyDatum {\n")
	for _, d := range data {
		s := fmt.Sprintf("%#v,\n", d)
		s = strings.ReplaceAll(s, "pkg.EnergyDatum", "EnergyDatum")
		g.MustWrite(s)
	}
	g.MustWrite("    }\n")
	g.MustWrite("}\n")

	g.Generate(outputFile)
}

// PDF 91 ページの「推定エネルギー必要量」のコピペ
const src = `0 ～ 5 （月） ─ 550 ─ ─ 500 ─
6 ～ 8 （月） ─ 650 ─ ─ 600 ─
9 ～11（月） ─ 700 ─ ─ 650 ─
1 ～ 2 （歳） ─ 950 ─ ─ 900 ─
3 ～ 5 （歳） ─ 1,300 ─ ─ 1,250 ─
6 ～ 7 （歳） 1,350 1,550 1,750 1,250 1,450 1,650
8 ～ 9 （歳） 1,600 1,850 2,100 1,500 1,700 1,900
10～11（歳） 1,950 2,250 2,500 1,850 2,100 2,350
12～14（歳） 2,300 2,600 2,900 2,150 2,400 2,700
15～17（歳） 2,500 2,800 3,150 2,050 2,300 2,550
18～29（歳） 2,300 2,650 3,050 1,700 2,000 2,300
30～49（歳） 2,300 2,700 3,050 1,750 2,050 2,350
50～64（歳） 2,200 2,600 2,950 1,650 1,950 2,250
65～74（歳） 2,050 2,400 2,750 1,550 1,850 2,100
75 以上（歳）2 1,800 2,100 ─ 1,400 1,650 ─
妊婦（付加量）3 初期
　　　　　　　中期
　　　　　　　後期
＋50
＋250
＋450
＋50
＋250
＋450
＋50
＋250
＋450
授乳婦（付加量） ＋350 ＋350 ＋350`
