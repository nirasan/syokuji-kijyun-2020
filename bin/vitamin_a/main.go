package main

import (
	"flag"
	"fmt"
	"strings"

	"github.com/nirasan/syokuji-kijyun-2020/pkg"
	"github.com/nirasan/syokuji-kijyun-2020/tools"
)

func main() {
	flag.Parse()
	pkgName := flag.Arg(0)
	outputFile := flag.Arg(1)

	data := make([]pkg.VitaminADatum, 0)

	lines := strings.Split(src, "\n")
	for i := 0; i <= 14; i++ {
		line := strings.ReplaceAll(lines[i], ",", "")
		cols := strings.Split(line, " ")
		j := len(cols) - 8
		d1 := newVitaminA(pkg.GenderMale, i, cols[j:j+4])
		d2 := newVitaminA(pkg.GenderFemale, i, cols[j+4:j+8])
		data = append(data, d1, d2)
	}

	g := tools.NewGenerator()
	g.MustWrite("// Code generated by \"bin/vitamin_a/main.go\"; DO NOT EDIT.\n")
	g.MustWrite("package %s\n", pkgName)
	g.MustWrite("func (vit *VitaminA) Data() []VitaminADatum {\n")
	g.MustWrite("    return []VitaminADatum {\n")
	for _, d := range data {
		s := fmt.Sprintf("%#v,\n", d)
		s = strings.ReplaceAll(s, "pkg.VitaminADatum", "VitaminADatum")
		s = strings.ReplaceAll(s, "pkg.NullFloat64", "NullFloat64")
		g.MustWrite(s)
	}
	g.MustWrite("    }\n")
	g.MustWrite("}\n")

	g.Generate(outputFile)
}

func newVitaminA(gender, age int, cols []string) pkg.VitaminADatum {
	vit := pkg.VitaminADatum{
		Gender: gender,
		Age:    age,
		EAR:    pkg.NullFloat64FromString(cols[0]),
		RDA:    pkg.NullFloat64FromString(cols[1]),
		AI:     pkg.NullFloat64FromString(cols[2]),
		UL:     pkg.NullFloat64FromString(cols[3]),
	}
	return vit
}

// PDF 212 ページの「ビタミン A の食事摂取基準」のコピペ
// 元本では「0歳6〜8ヶ月」と「0歳9〜11ヶ月」が結合されているので修正している
const src = `0 ～ 5 （月） ─ ─ 300 600 ─ ─ 300 600
6 ～ 8（月） ─ ─ 400 600 ─ ─ 400 600
9 ～11（月） ─ ─ 400 600 ─ ─ 400 600
1 ～ 2 （歳） 300 400 ─ 600 250 350 ─ 600
3 ～ 5 （歳） 350 450 ─ 700 350 500 ─ 850
6 ～ 7 （歳） 300 400 ─ 950 300 400 ─ 1,200
8 ～ 9 （歳） 350 500 ─ 1,200 350 500 ─ 1,500
10～11（歳） 450 600 ─ 1,500 400 600 ─ 1,900
12～14（歳） 550 800 ─ 2,100 500 700 ─ 2,500
15～17（歳） 650 900 ─ 2,500 500 650 ─ 2,800
18～29（歳） 600 850 ─ 2,700 450 650 ─ 2,700
30～49（歳） 650 900 ─ 2,700 500 700 ─ 2,700
50～64（歳） 650 900 ─ 2,700 500 700 ─ 2,700
65～74（歳） 600 850 ─ 2,700 500 700 ─ 2,700
75 以上（歳） 550 800 ─ 2,700 450 650 ─ 2,700
妊婦（付加量）初期 ＋0 ＋0 ─ ─
　　　　　中期 ＋0 ＋0 ─ ─
　　　　　　後期 ＋60 ＋80 ─ ─
授乳婦（付加量） ＋300 ＋450 ─ ─`
